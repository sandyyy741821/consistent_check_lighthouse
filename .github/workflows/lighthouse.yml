name: Lighthouse CI

on:
  workflow_dispatch:

jobs:
  lighthouseci:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: ğŸ“¦ Install frontend dependencies 
        run: npm ci --prefix frontend 

      - name: Install Dependencies
        run: sudo apt-get install -y libnss3 libatk1.0-0 libatk-bridge2.0-0 libcups2 libxcomposite1 libxrandr2 libxdamage1 libgbm1 libxshmfence1 libasound2t64 libxss1 libgtk-3-0 libdrm2

      - name: ğŸƒâ€â™‚ï¸ Start backend serve
        run: npm run dev --prefix backend &
        env:
          PORT: 3001

      - name: ğŸŒ Run Lighthouse test
        run: npm run lh:test --prefix frontend
        env:
          PUPPETEER_SKIP_CHROMIUM_DOWNLOAD: 'true'

      - name: ğŸ“¤ Upload Lighthouse Reports
        uses: actions/upload-artifact@v4
        with:
          name: lighthouse-reports
          path: frontend/lighthouse/*.html
